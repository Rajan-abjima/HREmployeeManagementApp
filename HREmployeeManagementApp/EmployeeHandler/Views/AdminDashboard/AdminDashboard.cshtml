@using Management.Entities.Common;
@model AdminDashboardViewModel

@section head{
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
}

<style>
    .dashboard{
        max-width:100% !important;
        height:100% !important;
    }
    
    .sidebar {
        height: 100%;
		background-color: #007bff;
        padding: 20px;
        color:white;
    }

    .sidebarItem > a{
        color: white;
        text-decoration:none;
    }

    .sidebarItem{
        margin-top: 2rem;
        margin-left: 1rem;

    }

    .main-area {
        padding: 20px;
    }

    .card-header {
        background-color: #007bff;
        color: #fff;
        padding: 10px;
    }

    .cardsize{
        width:70%; 
        text-align:center
    }

    .modal-content{
        border-radius: 20px;
        border: 2px #0062cc solid;
        background-image: linear-gradient(rgba(white, .1),rgba(white, .1));
    }
</style>

@section Header{
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3 hidingNav">
            <div class="container-fluid">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">Employee Management</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul class="navbar-nav flex-grow-1">
                        <li class="nav-item">
							<a class="nav-link text-dark" asp-area="" asp-controller="EmployeeAdmin" asp-action="EmployeeList">Employee Details</a>
                        </li>
                        <li class="nav-item">
							<a class="nav-link text-dark" asp-area="" asp-controller="AttendanceAdmin" asp-action="RegularizationRecord">Regulariztion Record</a>
                        </li>
                        <li class="nav-item">
							<a class="nav-link text-dark" asp-area="" asp-controller="AttendanceAdmin" asp-action="LeaveRecord">Leave Record</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link text-dark float-right" asp-area="" asp-controller="Login" asp-action="login">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="InterviewForm" asp-action="InterviewerForm">Interview Form</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
}

<section>
    <div class="container dashboard">
        <div class="row">
        
            <div class="col-lg-2 sidebar">
                <div class="sidebarItem"><h6>Admin: </h6></div>
                <div style="padding:.25rem .25rem; color: #007bff; background-color:white; text-align:center;"><h5 style="">@Model.EmployeeAdmin.FirstName @Model.EmployeeAdmin.LastName</h5></div>
                @*<div class="list-group">
					<div class="sidebarItem"><a href="@Url.Action("EmployeeList","EmployeeAdmin")"><h6>Employee Details</h6></a></div>
					<div class="sidebarItem"><a href="@Url.Action("RegularizationRecord","AttendanceAdmin")"><h6>Regulariztion Record</h6></a></div>
                    <div class="sidebarItem"><a href="@Url.Action("LeaveRecord","AttendanceAdmin")"><h6>Leave Record</h6></a></div>
                </div>*@
            </div>


		    <div class="col-md-10 main">
			    <h1 align="center">All Requests</h1>
                <div class="row mt-5">
                    
                    <!-- Regularization Requests -->
                    <div class="col-lg-6">
                        <div class="mx-auto cardsize">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Regularization Requests</h5>
                            </div>
                                @*<div id="pendingRegularizationRequests">
								</div>*@
                                <div>
									<div class="list-group list-group-flush">
										@foreach (RegularizationAdmin request in Model.PendingRegularizationRequests)
										{
											<a href="#regularizeConfirmModal" onClick="regularizeConfirmForm(@request.RegularizeID)" data-toggle="modal" rel="modal:open">
												<div class="list-group-item d-flex justify-content-between align-items-center">
													<span>@request.RegularizeDate.ToString("dd/MM/yyyy")</span>
													<span>@request.Reason</span>
												</div>
											</a>
										}
									</div>
								</div>
						    </div>
						</div>
                    </div>

                    <!-- Leave Requests -->
                    <div class="col-lg-6">
                        <div class="mx-auto cardsize">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Leave Requests</h5>
                                </div>
                                @*<div id="pendingLeaveRequests">

                                </div>*@
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!---------------------------------------------Regularization Request Confirmation From--------------------------------------->
            <div id="regularizeConfirmModal" tabindex="-1" class="modal p-4" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <form class="bg-light py-4 px-4" asp-controller="AttendanceAdmin" asp-action="ConfirmRegularizationRequest" method="post">
                                <h1>Regularization Form</h1>
                                <div class="row mt-3">
                                    <div class="col">
                                        <label for="AttendanceDate">Attendance Date</label>
										<input type="date" id="" class="form-control input-sm" readonly>
                                    </div>
                                    <div class="col">
                                        <label for="reason">Reason *</label>
										<input type="text" id="reason" class="form-control input-sm" readonly />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="row my-3 col">
                                        <div class="col">
                                            <label>Check In - Recorded</label>
                                            <input type="time" id="CheckedIn" class="form-control input-sm" readonly>
                                        </div>
                                        <div class="col mt-2">
                                            <label>Check Out - Recorded</label>
                                            <input type="time" id="" class="form-control input-sm" readonly>
                                        </div>
                                    </div>
                                    <div class="row my-3 col" id="SetChecks">
                                        <div class="col">
                                            <label>Set Check In *</label>
                                            <input id="setCheckIn" type="time" step="1" class="form-control input-sm" readonly>
                                        </div>
                                        <div class="col mt-2">
                                            <label>Set Check Out *</label>
                                            <input id="setCheckOut" type="time" step="1" class="form-control input-sm" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col mt-3 d-flex justify-content-between align-items-center">
                                    <span>Decision</span>
                                    <label class="radio inline m-1">
                                        <input type="radio" value="@RequestStatus.Approved" asp-for="RegularizationAdmin.Decision">
                                        <span> Approve </span>
                                    </label>
                                    <label class="radio inline m-1">
                                        <input type="radio" value="@RequestStatus.Declined" asp-for="RegularizationAdmin.Decision">
                                        <span> Decline </span>
                                    </label>
                                </div>
                                <div class="col mt-3">
                                    <label for="reason">Comment</label>
                                    <textarea type="text" class="form-control input-sm col" id="reason" rows="3" asp-for="RegularizationAdmin.Comment"></textarea>
                                </div>
                                <div class="NeededExtras">
                                    @*<input type="hidden" value="@Model.RegularizeID" asp-for="RegularizeID">*@
                                    <input type="hidden" id="RegularizeID" asp-for="RegularizationAdmin.RegularizeID">
                                </div>
                                <div class="row mx-auto my-3">
                                    <input class="btn btn-outline-primary col" type="submit" value="Confirm">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
@section Scripts{

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

@*<script>
	$('#pendingLeaveRequests').load("/AdminDashboard/PendingLeaveRequestsPartial")
</script>
<script>
	$('#pendingRegularizationRequests').load("/AdminDashboard/PendingRegularizationRequestsPartial")
</script>*@


<script>
    function regularizeConfirmForm(data) {
        var RegularizeID = JSON.stringify(data);
        $.ajax({
            type: "GET",
                url: "/AttendanceAdmin/CheckRegularizationRequest",
            data: {
                RegularizeID
            },
            success: function (response) {
                var myjson = JSON.stringify(response)
                console.log(myjson);
                $('#RegularizeID').val(response.regularizeID);
                $('#AttendanceDate').val(response.regularizeDate.substring(0, 10));
                $('#reason').val(response.reason);
                $('#CheckedIn').val(response.checkedIn.substring(11, 19));
                $('#CheckedOut').val(response.checkedOut.substring(11, 19));
                $('#setCheckIn').val(response.AppliedCheckIn.substring(11, 19));
                $('#setCheckOut').attr(response.AppliedCheckOut.substring(11, 19));
            },
            error: function (ex) {
                var r = jQuery.parseJSON(response.responseText);
                alert("Message: " + r.Message);
                alert("StackTrace: " + r.StackTrace);
                alert("ExceptionType: " + r.ExceptionType);
            }
        });
    };
</script>
}